#!/usr/bin/env python

import sys
import argh
import requests


def get_formulas():
    data = requests.get("https://api.github.com/users/saltstack-formulas/repos").json()
    formulas = filter(lambda x: x["name"].endswith("-formula"), data)
    return sorted(formulas, key=lambda x: x["name"])


def list():
    for i in get_formulas():
        print i["name"].replace("-formula", ""),
        if i["description"] and i["description"].strip():
            print "-", i["description"]
        else:
            print


def install(name):
    formulas = get_formulas()
    name = name.replace("-formula", "")
    if name not in [x["name"].replace("-formula", "") for x in formulas]:
        sys.stderr.write("Uknow formula: %s\n" % name)
        sys.exit(1)


parser = argh.ArghParser()
parser.add_commands([list, install])


if __name__ == '__main__':
    parser.dispatch()
